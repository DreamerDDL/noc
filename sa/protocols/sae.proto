package sae;

//
// RPC Transport
//
message Message {
    required uint32   id       = 1; // Transaction id
    optional Request  request  = 2;
    optional Response response = 3;
    optional Error    error    = 4;
}

message Request {
    required string method             = 1;
    required bytes  serialized_request = 2; // encoded *Request
}

message Response {
    optional bytes  serialized_response = 1; // encoded *Response
}

message Error {
    required ErrorCode code = 1;
    optional string    text = 2;
}
//
//
//
enum ErrorCode {
    ERR_OK                  = 0; //
    ERR_INTERNAL            = 1; // Unhandled exception on server side during request processing
    ERR_INVALID_METHOD      = 2; // Invalid method name
    ERR_INVALID_TRANSACTION = 3; // Transaction does not exists
    ERR_TRANSACTION_EXISTS  = 4;
    ERR_UNKNOWN_ACTIVATOR   = 5;
    ERR_INVALID_PROFILE     = 6; // Invalid profile
    ERR_INVALID_SCHEME      = 7; // Invalid access scheme
    ERR_UNKNOWN_TRAP_SOURCE = 8;
}

//
//
//
enum AccessScheme {
    TELNET = 0;
    SSH    = 1;
    HTTP   = 2;
}

message AccessProfile {
    required string       profile        = 1;
    required AccessScheme scheme         = 2;
    required string       address        = 3;
    optional string       port           = 4;
    optional string       user           = 5;
    optional string       password       = 6;
    optional string       super_password = 7;
    optional string       path           = 8;
}
//
// Ping server
// SAE->Activator
// Activator->SAE
message PingRequest {
}

message PingResponse {
}
//
// Register activator at the SAE
// Activator->SAE
message RegisterRequest {
    required string name = 1;
}

message RegisterResponse {
}
//
// Returns device configuration
// SAE->Activator
message PullConfigRequest {
    required AccessProfile access_profile = 1;
}

message PullConfigResponse {
    required string config  = 1;
}
//
// Software Upgrade
//
message FileChecksum {
    required string name   = 1; // Relative file name
    required string hash   = 2; // SHA1 hexdigest
}

message ManifestRequest {
}

message ManifestResponse {
    repeated FileChecksum files = 1;
}

message SoftwareUpgradeRequest {
    repeated string names = 1; // Relative file names
}

message FileCode {
    required string name = 1;
    required string code = 2;
}

message SoftwareUpgradeResponse {
    repeated FileCode codes = 1;
}
//
// SNMP Traps
//
enum TrapAction {
    TA_IGNORE=0;               // Drop trap
    TA_NOTIFY_CONFIG_CHANGE=1; // send ReqNotifyConfigChange
}

message TrapFilterRequest {
}

message TrapFilterResponse {
    message TrapFilter {
        message TrapFilterAction {
            required string     oid     = 1;
            repeated TrapAction actions = 2;
        }
        required string           ip      = 1;
        repeated TrapFilterAction actions = 2;
    }
    repeated TrapFilter filters = 1;
}

message NotifyResponse {
}

message NotifyTrapConfigChangeRequest {
    required string ip = 1;
}

//
// RPC Services
//
service SAEService {
    rpc ping             (PingRequest)            returns (PingResponse);
    rpc register         (RegisterRequest)        returns (RegisterResponse);
    rpc manifest         (ManifestRequest)        returns (ManifestResponse);
    rpc software_upgrade (SoftwareUpgradeRequest) returns (SoftwareUpgradeResponse);
    rpc pull_config      (PullConfigRequest)      returns (PullConfigResponse);
    rpc get_trap_filter  (TrapFilterRequest)      returns (TrapFilterResponse);
    rpc notify_trap_config_change(NotifyTrapConfigChangeRequest) returns(NotifyResponse);
}