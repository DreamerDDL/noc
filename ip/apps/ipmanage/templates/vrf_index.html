{% extends "template.html" %}
{% load tags %}
{% block breadcrumbs %}{{block.super}}<li><a href='{% url ip:ipmanage:vrf_index vrf.id "0.0.0.0/0"%}'>VRF: {{vrf.name}}</A></li>
{% endblock %}
{% block content %}
{% if can_allocate %}
    <ul class="object-tools">
        <li><A HREF="{% url ip:tools:index vrf.id prefix %}" CLASS="changelink">Tools</A></li>
        <li><A HREF="{% url ip:ipmanage:allocate_block vrf.id %}" CLASS="addlink">Allocate new block</A></li>
        <li><A HREF="{% url ip:ipmanage:assign_address vrf.id %}" CLASS="addlink">Assign address</A></li>
    </ul>
{% endif %}
<SCRIPT TYPE="text/javascript">
    <!--
    function confirm_delete(msg)
    {
        var agree=confirm(msg);
        if (agree)
            return true;
        else
            return false;
    }
    // -->
</SCRIPT>
<!-- Navigation -->
<style>
.ipnav, .ipnav li {
    margin: 0;
    padding: 0;
    display: inline;
    list-style: none;
}

.ipnav li:before {
    content: "\00a0";
}

.ipnav li:after {
    content: "\00a0\203a";
}

.freeip {
    font-style: italic;
    background-color: #CCCCCC;
    display: none;
}

/* Column widths */
th[class=ip] {
    width: 7em;
}

th[class=range] {
    width: 1em;
}

th[class=fqdn] {
    width: 17em;
}

th[class=tt] {
    width: 5em;
}
/* Range colors */
{% for r,c in range_colors %}
    td[class=r{{r.id}}] {
        background-color: {{c}};
    }
{% endfor %}
</style>
<DIV CLASS="module" style="height: 24px">
    <ul class="ipnav">
        <li><a href="{% url ip:ipmanage:vrf_index prefix.vrf.id '0.0.0.0/0' %}>">VRF {{vrf.name}}</a></li>
    {% for p in parents %}
        <li><a href="{% url ip:ipmanage:vrf_index vrf.id p.prefix %}" title="{{p.description}}">{{p.prefix}}</a></li>
    {% endfor %}
    <li><a href='{% url ip:ipmanage:vrf_index vrf.id prefix.prefix %}' title="{{prefix.description}}">{{prefix.prefix}}</a></li>
    </ul>
    <span style="float: right">
        <form method="POST" action="{% url ip:ipmanage:quickjump prefix.vrf.id %}">
            <input type="search" name="jump" placeholder="Quick jump ..."/>
        </form>
    </span>
</DIV>
<h1>VRF {{vrf.name}}: {{prefix.prefix}} ({{prefix.description}})</h1>
<!-- Allocated blocks -->
{% if prefixes %}
    <DIV CLASS="module">
        <TABLE SUMMARY="Allocated blocks" WIDTH="100%">
            <caption>Allocated blocks</caption>
            <THEAD>
                <TR><TH class="ip">Prefix</TH><TH class="ip">VRF</TH><TH>Description</TH><TH>VC</TH><TH class="tt">TT</TH><TH>Tags</TH></TR>
            </THEAD>
            {%for p in prefixes %}
            <TR class="{%cycle 'row1' 'row2'%}">
                <TD><A HREF="{% url ip:ipmanage:vrf_index p.vrf_id p.prefix %}">{{p.prefix}}</A></TD>
                <TD><A HREF="{% url ip:ipmanage:vrf_index p.vrf_id '0.0.0.0/0' %}">{{p.vrf.name}}</A></TD>
                <TD>{{p.description}}</TD>
                <TD>{% if p.vc %}{{p.vc}}{% endif %}</TD>
                <TD>{%if p.tt %}<A HREF="{{p.tt_url}}">#{{p.tt}}</A>{%endif%}</TD>
                <TD>{% tags p %}</TD>
            </TR>
            {%endfor%}
        </TABLE>
    </DIV>
{% endif %}
{% if has_children %}
<!-- orphaned addresses -->
{%if orphaned_addresses%}
<DIV CLASS="module">
    <TABLE SUMMARY="Orphaned addresses" WIDTH="100%">
        <caption>Orphaned addresses</caption>
        <THEAD>
            <TR><TH class="ip">IP</TH><TH class="fqdn">FQDN</TH><TH>Description</TH><TH class="tt">TT</TH></TR>
        </THEAD>
        {% for a in orphaned_addresses %}
        <TR class="{%cycle 'row1' 'row2'%}">
        <TD>{% if can_allocate %}<A HREF="{% url ip:ipmanage:change_address vrf.id a.ip %}">{{a.ip}}</A>{%else%}{{a.ip}}{%endif%}</TD>
        <TD>{{a.fqdn}}</TD>
        <TD>{{a.description}}</TD>
        <TD>{%if a.tt %}<A HREF="{{a.tt_url}}">#{{a.tt}}</A>{%endif%}</TD>
        </TR>
        {% endfor %}
    </TABLE>
</DIV>
{% endif %}
{% else %}
<!-- Assigned addresses -->
<SCRIPT TYPE="text/javascript">
var _ft_shown=false;

function toggle_free() {
    if(_ft_shown) {
        $(".freeip").each(function (i){this.style.display="none";});
        $("#free_ip_toggle_button").text("Show Free Addresses");
        _ft_shown=false;
    } else {
        $(".freeip").each(function (i){this.style.display="table-row";});
        $("#free_ip_toggle_button").text("Hide Free Addresses");
        _ft_shown=true;
    }
}
</SCRIPT>
<DIV CLASS="module">
    <TABLE SUMMARY="Assigned addresses" WIDTH="100%">
        <caption>Assigned addresses <A HREF="#" ONCLICK="toggle_free();" style="float: right" id="free_ip_toggle_button">Show Free Addresses</A></caption>
        <THEAD>
            <TR><TH class="range"></TH><TH class="ip">IP</TH><TH class="fqdn">FQDN</TH><TH>Description</TH><TH class="tt">TT</TH><TH>Tags</TH></TR>
        </THEAD>
        {% for r,a in all_addresses %}
            {% if a.ip %}
                <TR class="{%cycle 'row1' 'row2'%}">
                <TD {%if r%}class="r{{r.id}}"{%endif%}></TD>
                <TD>
                    {% if can_allocate %}
                        <A HREF="{% url ip:ipmanage:change_address vrf.id a.ip %}">{{a.ip}}</A>
                    {%else%}
                        {{a.ip}}
                    {%endif%}
                </TD>
                <TD>{{a.fqdn}}</TD>
                <TD>{{a.description}}</TD>
                <TD>{%if a.tt %}<A HREF="{{a.tt_url}}">#{{a.tt}}</A>{%endif%}</TD>
                <TD>{% tags a %}</TD>
                </TR>
            {% else %}
                <TR CLASS="freeip">
                <TD {%if c%}STYLE="background-color: {{c}}"{%endif%}></TD>
                <TD COLSPAN=2>
                    {% if can_allocate %}
                        <A HREF="{% url ip:ipmanage:assign_new_address vrf.id a %}">{{a}}</A>
                    {%else%}
                        {{a}}
                    {% endif %}
                </TD>
                <TD>Free</TD>
                <TD></TD>
                <TD></TD>
                </TR>
            {% endif %}
        {% endfor %}
    </TABLE>
</DIV>
{% if ranges %}
    <DIV CLASS="module">
        <TABLE SUMMARY="Address Ranges" WIDTH="100%">
            <CAPTION>Address Ranges</CAPTION>
            <THEAD>
                <TR><TH class="range"></TH><TH>Name</TH><TH>From IP</TH><TH>To IP</TH><TH>Locked</TH><TH>Description</TH></TR>
            </THEAD>
            {% for r in ranges %}
            <TR class="{%cycle 'row1' 'row2'%}">
                <TD class="r{{r.id}}"></TD>
                <TD>{{r.name}}</TD>
                <TD>{{r.from_ip}}</TD>
                <TD>{{r.to_ip}}</TD>
                <TD><img src="/media/img/admin/icon-{%if r.is_locked%}yes{%else%}no{%endif%}.gif"></TD>
                <TD>{{r.description}}</TD>
            </TR>
            {% endfor %}
        </TABLE>
    </DIV>
{% endif %}
{% endif %}

<DIV CLASS="module">
    <TABLE SUMMARY="Block info" WIDTH="100%">
        <CAPTION>{{prefix.prefix}} info</CAPTION>
        {% if prefix.tags %}
        <TR class="row2">
            <TD><B>Tags</B></TD>
            <TD>{%tags prefix%}</TD>
        </TR>
        {% endif %}
        <TR class="row1">
            <TD><b>VC</b></TD>
            <TD>
                {% if prefix.vc %}{{prefix.vc}}{% endif %}
                {% if can_allocate %}
                <a href="{% url ip:ipmanage:bind_vc vrf.id prefix %}"><b>{%if prefix.vc%}Change{%else%}Bind{%endif%}...</b></a>
                {% endif %}
            </TD>
        </TR>
        <TR class="row2">
            <TD><b>Maintainers</b></TD>
            <TD>{{prefix.maintainers|join:", "}} {%if can_allocate%}<a href="{% url ip:ipv4blockaccess:add %}?vrf={{vrf.id}}&prefix={{prefix}}"><b>Add...<b></a>{%endif%}</TD>
        </TR>
        {% for k,v in block_info %}
            <TR class="{%cycle 'row1' 'row2'%}"><TD STYLE="width: 10pt"><b>{{k}}</b></TD><TD>{{v}}</TD></TR>
        {% endfor %}
    </TABLE>
</DIV>

<div class="submit-row">
    <A HREF="{% url ip:ipmanage:change_block prefix.vrf.id prefix.prefix %}" CLASS="changelink">Change</A>
    <A HREF="{% url ip:ipmanage:deallocate_block prefix.vrf_id prefix.prefix %}"
        CLASS="deletelink" ONCLICK="return confirm_delete('Deallocate block {{prefix.prefix}} ({{prefix.description}})?')">Delete</A>
</div>

{% endblock %}
