#!/bin/sh
#
# Service Activation Engine daemon
#

getproparg() {
    val=`svcprop -p $1 $SMF_FMRI`
    [ -n "$val" ] && echo $val
}

if [ -z "$SMF_FMRI" ]; then
    echo "Error: SMF framework variables are not initialized"
    exit $SMF_EXIT_ERR
fi

PREFIX=`getproparg noc-sae/prefix`
PYTHON=`getproparg noc-sae/python`
PIDFILE=`getproparg noc-sae/pidfile`
LOGFILE=`getproparg noc-sae/logfile`
SAE="$PREFIX/scripts/noc-sae.py"

case "$1" in
start)
    $PYTHON $SAE -l$LOGFILE -p$PIDFILE 2>&1
    ;;
stop)
    [ -f "$PIDFILE" ] && /usr/bin/kill -QUIT `/usr/bin/cat $PIDFILE` && rm -f $PIDFILE
    ;;
refresh)
    $0 stop
    $0 start
    ;;
*)
    echo "Usage: $0 {start|stop|refresh}"
    exit $SMF_EXIT_ERR_CONFIG
    ;;
esac
exit $SMF_EXIT_OK