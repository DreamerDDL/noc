{% extends "template.html" %}
{% block breadcrumbs %}{{block.super}}<li>{{e.id}}</li>{% endblock %}
{% block content %}
<ul class="object-tools">
    <li><a href="#" onclick="return show_popup('JSON', '{% url fm:event:to_json e.id%}')">JSON</a></li>
    {% if e.status == "A" or e.status == "S" or e.status == "F" %}
    <li><a href="{% url fm:event:reclassify e.id%}">Reclassify</a></li>
{% endif %}
    <LI><A HREF="{% url fm:classificationrule:from_event e.id %}"class="addlink">Create Rule</A></LI>
</ul>
<style>
    div#s-toc ul, div#s-toc li{
        margin: 0px;
        padding: 0px;
        margin-right: 4px;
        display: inline;
        list-style: none;
    }
    
    #change_priority {
        display: none;
    }
</style>
<script type="text/javascript">
    function toggle_module(m_selector, l_selector) {
        var $m = $(m_selector);
        var $l = $(l_selector);
        
        if ($m.is(":hidden")) {
            $l.html("[Hide]");
            $m.show();
        } else {
            $l.html("[Show]");
            $m.hide();
        }
        return false;
    }
</script>
<h1>Event #{{e.id}}: {{e.subject}}</h1>
<div class="module">
    <a name="summary"></a>
    <h2>Summary</h2>
    <table WIDTH="100%">
        <tr><TD STYLE="width: 150px"><b>Managed Object:</b></td><td>{{e.managed_object.name}} {% if e.managed_object.platform %}({{e.managed_object.platform}}){% endif %}</td></tr>
        {% if e.status == 'A' or e.status == 'C' %}
        <tr><td><b>Event Class:</b></td><td>{{e.event_class}}</td></tr>
        {% endif %}
        <tr><td><b>Event Status:</b></td>
            <td>
                {% if e.status == "U" %}Unclassified{% endif %}
                {% if e.status == "A" %}Active{% endif %}
                {% if e.status == "C" %}Closed{% endif %}
                {% if e.status == "F" %}Failed{% endif %}
            </td>
        </tr>
        <tr><td><b>Time:</b></td><td>{{e.timestamp}}</TD</tr>
        <tr>
            <td><b>Sections:</b></td>
            <td>
                <div id="s-toc">
                    <ul>
                        {% if e.status == 'A' or e.status == 'S' %}
                        <li><a href="#text">Text</a></li>
                        <li><a href="#symptoms">Symptoms</a></li>
                        <li><a href="#pcauses">Probable Causes</a></li>
                        <li><a href="#recommended_actions">Recommended Actions</a></li>
                        <li><a href="#event_data">Event Data</a></li>
                        <li><a href="#event_resolved">Resolved Variables</a></li>
                        {% endif %}
                        <li><a href="#event_raw">Raw Data</a></li>
                        <li><a href="#log">Log</a></li>
                    </ul>
                </div>
            </td>
        </tr>  
    </table>
</div>


{% if e.status == 'A' or e.status == 'C' %}
    <div class="module">
        <a name="text"></a>
        <h2>Subject: {{subject}}</h2>
    
        <pre>{{body}}</pre>
    </div>

    {% if symptoms %}
        <div class="module">
            <a name="symptoms"></a>
            <h2>Symptoms</h2>
            <pre>{{symptoms}}</pre>
        </div>
    {%endif%}

    {% if probable_causes %}
        <div class="module">
            <a name="pcauses"></a>
            <h2>Probable causes</h2>
            <pre>{{probable_causes}}</pre>
        </div>
    {%endif%}

    {% if recommended_actions %}
        <div class="module">
            <a name="recommended_actions"></a>
            <h2>Recommended actions</h2>
            <pre>{{recommended_actions}}</pre>
        </div>    
    {%endif%}
    
<div class="module">
    <a name="event_data"></a>
    <h2>Event Data
        <span style="float: right">
            <a  id="t-vars-l" href="#" onclick="return toggle_module('#t-vars', '#t-vars-l');">[Show]</a>
        </span>
    </h2>
    <table id="t-vars" width="100%" style="display: none;">
        {% for k, v in e.vars.items %}
            <tr class="{% cycle 'row1' 'row2' %}">
                <td><b>{{k}}</b></td>
                <td>{{v}}</td>
            </tr>
        {% endfor %}
    </table>
</div>

<div class="module">
    <a name="event_resolved"></a>
    <h2>Resolved variables
            <span style="float: right">
            <a id="t-resolved-vars-l" href="#" onclick="return toggle_module('#t-resolved-vars', '#t-resolved-vars-l');">[Show]</a>
        </span>
    </h2>
    <table id="t-resolved-vars" width="100%" style="display: none;">
        {% for k, v in e.resolved_vars.items %}
            <tr class="{% cycle 'row1' 'row2' %}">
                <td><b>{{k}}</b></td>
                <td>{{v}}</td>
            </tr>
        {% endfor %}
    </table>
</div>
{% endif %}

{% if e.status == "F" %}
    <div class="module">
        <h2>Error diagnostics</h2>
        <table border="0" width="100%">
            <tr>
                <td><b>NOC version</b></td>
                <td>{{e.version}}</td>
            </tr>
            <tr>
                <td><b>Traceback</b></td>
                <td><pre>{{e.traceback}}</pre></td>
            </tr>
        </table>
    </div>
{% endif %}

<div class="module">
    <a name="event_raw"></a>
    <h2>Raw data
        <span style="float: right">
            <a id="t-raw-vars-l" href="#" onclick="return toggle_module('#t-raw-vars', '#t-raw-vars-l');">[Show]</a>
        </span>
    </h2>
    <table id="t-raw-vars" width="100%" style="display: none;">
        {% for k, v in e.raw_vars.items %}
            <tr class="{% cycle 'row1' 'row2' %}">
                <td><b>{{k}}</b></td>
                <td>{{v}}</td>
            </tr>
        {% endfor %}
    </table>
</div>

<div class="module">
    <a name="log"></a>
    <h2>Log</h2>
    <table width="100%">
        <thead>
            <tr><th>Timestamp</th><th>Status</th><th>Message</th></tr>
        </thead>
        {% for l in e.log %}
            <tr class="{% cycle 'row1' 'row2' %}">
                <td>{{l.timestamp}}</td>
                <td>{{l.from_status}} -&gt; {{l.to_status}}</td>
                <td>{{l.message}}</td>
            </tr>
        {% endfor %}
        <tr>
            <td colspan="5">
                <b>Post a message:</b><br/>
                <form action="{% url fm:event:message e.id %}" method="POST" id="message_form">{% csrf_token %}
                    <textarea id="id_message" name="message" rows="5" cols="80"></textarea><br/>
                    <input type="submit" value="Post message" />
                </form>
            </td>
    </table>
</div>

<script>
    $(document).ready(function(){
        $("#e_priority").corner();
    });
</script>
{%endblock%}
