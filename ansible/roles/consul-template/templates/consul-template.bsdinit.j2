#!/bin/sh

# PROVIDE: consul_template
# REQUIRE: LOGIN
# KEYWORD: shutdown

. /etc/rc.subr

name="consul_template"
rcvar=consul_template_enable

load_rc_config $name
: "${consul_template_enable="NO"}"
: "${consul_template_users="{{ consul_user }}"}"

consul_template_pidfile="/var/run/consul/consul-template.pid"
command="{{ consul_template_bin_path }}/consul-template"
command_args="-config {{consul_template_config_dir}}/{{ consul_template_config_file }} -pid-file=${consul_template_pidfile} -dedup -kill-signal=SIGTERM &"
start_precmd="${name}_prestart"
extra_commands="reload"
reload_cmd=":"

consul_template_prestart()
{
    if [ ! -d /var/run/consul/ ]; then
        mkdir /var/run/consul
    fi
    chown -R "{{ consul_user }}:{{ consul_group }}" /var/run/consul/
}

run_rc_command "$1"
