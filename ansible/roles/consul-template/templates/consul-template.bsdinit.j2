#!/bin/sh

# PROVIDE: consul_template
# REQUIRE: LOGIN
# KEYWORD: shutdown

. /etc/rc.subr

name="consul_template"
rcvar=consul_template_enable

load_rc_config $name
: "${consul_template_enable="NO"}"
: "${consul_template_users="{{ consul_user }}"}"

consul_template_pidfile="/var/run/consul/consul-template.pid"
command="{{ consul_template_bin_path }}/consul-template"
command_args="-config={{ consul_template_templates_dir }} -pid-file=${consul_template_pidfile}"
start_precmd="${name}_prestart"

consul_template_prestart()
{
    mkdir /var/run/consul
    chown -R "{{ consul_user }}:{{ consul_group }}" /var/run/consul/
}

run_rc_command "$1"
